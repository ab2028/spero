<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summer School LMS</title>
    <link rel="stylesheet" href="style.css">
    
</head>
<body>
    <div class="container">
        <!-- Header with course buttons -->
        <div class="header">
            <div class="course-buttons" id="courseButtons">
                <button class="add-course-btn" onclick="addNewCourse()">+ Add Course</button>
            </div>
        </div>

        

        <!-- Main content area -->
        <div id="mainContent">
            <!-- Main timer -->
            <div class="main-timer">
                <div class="current-time" id="currentTime"></div>
                <div class="current-activity" id="currentActivity">Loading schedule...</div>
            </div>

            <!-- Schedule section -->
            <div class="schedule-section">
                <div class="schedule-header">
                    <h2 id="weekTitle">Week of</h2>
                    <div class="week-nav">
                        <button class="nav-btn" onclick="previousWeek()">← Previous</button>
                        <button class="nav-btn" onclick="nextWeek()">Next →</button>
                    </div>
                </div>
                <table class="schedule-table">
  <thead>
    <tr>
      <th></th> <!-- drag handle -->
      <th>Period</th>
      <th>Sun</th>
      <th>Mon</th>
      <th>Tue</th>
      <th>Wed</th>
      <th>Thu</th>
      <th>Fri</th>
      <th>Sat</th>
      <th></th> <!-- delete button -->
    </tr>
  </thead>
  <tbody id="scheduleBody">
    <!-- Rows go here dynamically -->
  </tbody>
</table>


                <button class="add-row-btn" onclick="addScheduleRow()">+ Add Period</button>
            </div>
        </div>

        <!-- Course Dashboard -->
        <div class="course-dashboard" id="courseDashboard">
            <div class="dashboard-header">
                <div>
                    <button class="back-btn" onclick="showMainContent()">← Back to Schedule</button>
                    <h2 id="courseName">Course Dashboard</h2>
                </div>
                <div class="course-timer">
                    <div class="timer-display" id="timerDisplay">00:00:00</div>
                    <div class="timer-controls">
                        <input type="number" class="timer-input" id="timerMinutes" placeholder="Minutes" min="1" max="300">
                        <button class="timer-btn start-btn" onclick="startTimer()">Start</button>
                        <button class="timer-btn pause-btn" onclick="pauseTimer()">Pause</button>
                        <button class="timer-btn reset-btn" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
            </div>
            <div class="dashboard-content">
                <div class="units-section">
                    <button class="add-unit-btn" onclick="addNewUnit()">+ Add Unit</button>
                    <div class="units-grid" id="unitsGrid">
                    </div>
                </div>
                <div class="notepad-section">
                    <h3>Useful Links</h3>
                    <textarea class="notepad" id="courseNotepad" placeholder="Add useful links and notes here..."></textarea>
                </div>
            </div>
        </div>

        <!-- Unit View -->
        <div class="unit-view" id="unitView">
            <div class="unit-header">
                <button class="back-btn" onclick="goToDashboard()">← Back to Course</button>
                <h2 id="unitName">Unit View</h2>
            </div>
            <button class="add-note-btn" onclick="addNoteSection()">+ Add Note Section</button>
            <div class="notes-grid" id="notesGrid">
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Course</h3>
                <span class="close" onclick="closeModal('courseModal')">&times;</span>
            </div>
            <input type="text" id="courseNameInput" class="modal-input" placeholder="Course Name (e.g., AMC 10)">
            <button class="modal-btn" onclick="createCourse()">Create Course</button>
        </div>
    </div>

    <div id="unitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Unit</h3>
                <span class="close" onclick="closeModal('unitModal')">&times;</span>
            </div>
            <input type="text" id="unitNameInput" class="modal-input" placeholder="Unit Name (e.g., 2023 Problems)">
            <button class="modal-btn" onclick="createUnit()">Create Unit</button>
        </div>
    </div>

    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Note Section</h3>
                <span class="close" onclick="closeModal('noteModal')">&times;</span>
            </div>
            <input type="text" id="noteTitleInput" class="modal-input" placeholder="Note Section Title">
            <button class="modal-btn" onclick="createNoteSection()">Create Section</button>
        </div>
    </div>

    <div id="subsectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="subsectionTitle">Add Subsection</h3>
                <span class="close" onclick="closeModal('subsectionModal')">&times;</span>
            </div>
            <input type="text" id="subsectionTitleInput" class="modal-input" placeholder="Subsection Title">
            <textarea id="subsectionContent" class="modal-textarea" placeholder="Enter your content here. You can use:
• Bullet points (use • or -)
1. Numbered lists
2. Multiple paragraphs

Just type naturally!"></textarea>
            <button class="modal-btn" onclick="saveSubsection()">Save</button>
        </div>
    </div>

    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="viewTitle">View Content</h3>
                <span class="close" onclick="closeModal('viewModal')">&times;</span>
            </div>
            <div id="viewContent"></div>
            <button class="modal-btn" onclick="editCurrentSubsection()">Edit</button>
        </div>
    </div>


    <script>

        // Global variables
        let currentCourse = null;
        let currentUnit = null;
        let currentWeekOffset = 0;
        let courseTimer = null;
        let timerInterval = null;
        let currentNoteSection = null;
        let currentSubsection = null;

        // Initialize app
        function initApp() {
            loadData();
            initializeSchedule();
            updateClock();
            updateCurrentActivity();
            setInterval(updateClock, 1000);
            setInterval(updateCurrentActivity, 60000);
            setInterval(autoSave, 5000); // Auto-save every 5 seconds
        }

        // Data persistence
        function saveData() {
            const dataToSave = {
                courses: appData.courses,
                schedule: appData.schedule,
                weekOffset: currentWeekOffset
            };
            try {
                // In a real environment, you would use localStorage here
                // For Claude.ai artifacts, we'll keep it in memory
                console.log('Data saved (in memory only)');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        function loadData() {
            try {
                // In a real environment, you would load from localStorage here
                // For Claude.ai artifacts, we'll use default data
                if (!appData.courses || Object.keys(appData.courses).length === 0) {
                    // Initialize with default courses
                    appData.courses = {
                        'AMC 10': { units: {}, notepad: '' },
                        'AMC 12': { units: {}, notepad: '' },
                        'AIME': { units: {}, notepad: '' }
                    };
                }
                updateCourseButtons();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function autoSave() {
            saveData();
        }

        // Course management
       function updateCourseButtons() {
  const buttonsContainer = document.getElementById('courseButtons');
  const addButton = buttonsContainer.querySelector('.add-course-btn');

  // Remove all existing course wrappers
  buttonsContainer.querySelectorAll('.course-wrapper').forEach(el => el.remove());

  Object.keys(appData.courses).forEach(courseName => {
    const courseWrapper = document.createElement('div');
    courseWrapper.className = 'course-wrapper';
    courseWrapper.draggable = true;
    courseWrapper.dataset.course = courseName;
    courseWrapper.style.display = 'flex';
    courseWrapper.style.alignItems = 'center';
    courseWrapper.style.gap = '5px';

    // Drag logic
    courseWrapper.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('text/plain', courseName);
    });

    courseWrapper.addEventListener('dragover', (e) => {
      e.preventDefault();
    });

    courseWrapper.addEventListener('drop', (e) => {
      e.preventDefault();
      const draggedCourse = e.dataTransfer.getData('text/plain');
      const targetCourse = courseWrapper.dataset.course;

      reorderCourses(draggedCourse, targetCourse);
      saveData();
      updateCourseButtons();
    });

    const button = document.createElement('button');
    button.className = 'course-btn';
    button.textContent = courseName;
    button.onclick = () => showCourseDashboard(courseName);

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = '×';
    deleteBtn.style.color = 'white';
    deleteBtn.style.background = '#dc3545';
    deleteBtn.style.border = 'none';
    deleteBtn.style.borderRadius = '4px';
    deleteBtn.style.cursor = 'pointer';
    deleteBtn.onclick = () => deleteCourse(courseName);

    courseWrapper.appendChild(button);
    courseWrapper.appendChild(deleteBtn);
    buttonsContainer.insertBefore(courseWrapper, addButton);
  });
}


        
        function reorderCourses(draggedName, targetName) {
  const entries = Object.entries(appData.courses);
  const draggedIndex = entries.findIndex(([name]) => name === draggedName);
  const targetIndex = entries.findIndex(([name]) => name === targetName);

  if (draggedIndex === -1 || targetIndex === -1 || draggedIndex === targetIndex) return;

  const [draggedItem] = entries.splice(draggedIndex, 1);
  entries.splice(targetIndex, 0, draggedItem);
  appData.courses = Object.fromEntries(entries);
}



        function addNewCourse() {
            document.getElementById('courseModal').style.display = 'block';
        }

        function createCourse() {
            const courseName = document.getElementById('courseNameInput').value.trim();
            if (courseName && !appData.courses[courseName]) {
                appData.courses[courseName] = { units: {}, notepad: '' };
                updateCourseButtons();
                closeModal('courseModal');
                document.getElementById('courseNameInput').value = '';
                saveData();
            }
        }

        // Schedule management
        function initializeSchedule() {
            const defaultPeriods = [
                'Wakeup (7:30)',
                'P1 (8-9:45)',
                'P2 (10-11:45)',
                'Lunch (12-1)',
                'P3 (1-2:45)',
                'P4 (3-4:45)',
                'P5 (5-6:45)',
                'P6 (7-8:45)',
                'P7 (9-9:45)',
                'Sleep (10-10:30)'
            ];

            const weekKey = getWeekKey();
            if (!appData.schedule[weekKey]) {
                appData.schedule[weekKey] = {};
                defaultPeriods.forEach(period => {
                    appData.schedule[weekKey][period] = ['', '', '', '', '', '', ''];
                });
            }
            
            updateScheduleDisplay();
            updateWeekTitle();
        }

        function getWeekKey() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + (currentWeekOffset * 7));
            return weekStart.toISOString().split('T')[0];
        }

        function updateWeekTitle() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + (currentWeekOffset * 7));
            
            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            document.getElementById('weekTitle').textContent = 
                `Week of ${weekStart.toLocaleDateString('en-US', options)}`;
        }

      function updateScheduleDisplay() {
    const weekKey = getWeekKey();
    const scheduleData = appData.schedule[weekKey] || {};
    const tbody = document.getElementById('scheduleBody');
    tbody.innerHTML = '';

    const entries = Object.entries(scheduleData);

    entries.forEach(([period, days]) => {
        const row = document.createElement('tr');
        row.draggable = true;
        row.dataset.period = period;

        // Drag handle cell
        const dragCell = document.createElement('td');
        dragCell.innerHTML = '☰';
        dragCell.style.cursor = 'grab';
        dragCell.style.textAlign = 'center';
        dragCell.style.color = '#888';
        dragCell.style.width = '30px';
        dragCell.style.userSelect = 'none';
        dragCell.style.fontSize = '18px';
        row.appendChild(dragCell);

        // Period cell
        const periodCell = document.createElement('td');
        periodCell.contentEditable = true;
        periodCell.textContent = period;
        periodCell.style.fontWeight = 'bold';
        periodCell.style.background = '#f8f9ff';
        periodCell.addEventListener('blur', () => {
            const newPeriod = periodCell.textContent.trim();
            if (newPeriod !== period && newPeriod) {
                scheduleData[newPeriod] = scheduleData[period];
                delete scheduleData[period];
                saveData();
                updateScheduleDisplay();
            }
        });
        row.appendChild(periodCell);

        // Day cells
        const dayOrder = [0, 1, 2, 3, 4, 5, 6];
        for (let i = 0; i < 7; i++) {
            const cell = document.createElement('td');
            cell.contentEditable = true;
            cell.textContent = days[i] || '';
            cell.addEventListener('blur', () => {
                scheduleData[period][i] = cell.textContent;
                saveData();
            });
            row.appendChild(cell);
        }

        // Delete button cell
        const deleteCell = document.createElement('td');
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '×';
        deleteBtn.style.background = '#dc3545';
        deleteBtn.style.color = 'white';
        deleteBtn.style.border = 'none';
        deleteBtn.style.borderRadius = '4px';
        deleteBtn.style.cursor = 'pointer';
        deleteBtn.onclick = () => deleteScheduleRow(period);
        deleteCell.appendChild(deleteBtn);
        row.appendChild(deleteCell);

        // Drag events
        row.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', period);
        });

        row.addEventListener('dragover', (e) => {
            e.preventDefault();
            row.style.outline = '2px dashed #ccc';
        });

        row.addEventListener('dragleave', () => {
            row.style.outline = '';
        });

        row.addEventListener('drop', (e) => {
            e.preventDefault();
            row.style.outline = '';

            const draggedPeriod = e.dataTransfer.getData('text/plain');
            const targetPeriod = row.dataset.period;

            const reordered = Object.entries(scheduleData);
            const fromIndex = reordered.findIndex(([p]) => p === draggedPeriod);
            const toIndex = reordered.findIndex(([p]) => p === targetPeriod);

            if (fromIndex !== -1 && toIndex !== -1 && fromIndex !== toIndex) {
                const [draggedItem] = reordered.splice(fromIndex, 1);
                reordered.splice(toIndex, 0, draggedItem);
                appData.schedule[weekKey] = Object.fromEntries(reordered);
                saveData();
                updateScheduleDisplay();
            }
        });

        tbody.appendChild(row);
    });
}


        function addScheduleRow() {
            const weekKey = getWeekKey();
            if (!appData.schedule[weekKey]) {
                appData.schedule[weekKey] = {};
            }
            
            const newPeriod = `New Period ${Object.keys(appData.schedule[weekKey]).length + 1}`;
            appData.schedule[weekKey][newPeriod] = ['', '', '', '', '', '', ''];
            updateScheduleDisplay();
            saveData();
        }

        function previousWeek() {
            currentWeekOffset--;
            updateWeekTitle();
            initializeSchedule();
        }

        function nextWeek() {
            currentWeekOffset++;
            updateWeekTitle();
            initializeSchedule();
        }

        // Clock and activity tracking
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: true, 
                hour: 'numeric', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        function updateCurrentActivity() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const timeSlots = [
                { start: 450, end: 480, activity: "Wake up time! ☀️" },
                { start: 480, end: 585, activity: "Period 1 (8:00-9:45)" },
                { start: 600, end: 705, activity: "Period 2 (10:00-11:45)" },
                { start: 720, end: 780, activity: "Lunch Break 🍽️" },
                { start: 780, end: 885, activity: "Period 3 (1:00-2:45)" },
                { start: 900, end: 1005, activity: "Period 4 (3:00-4:45)" },
                { start: 1020, end: 1125, activity: "Period 5 (5:00-6:45)" },
                { start: 1140, end: 1245, activity: "Period 6 (7:00-8:45)" },
                { start: 1260, end: 1305, activity: "Period 7 (9:00-9:45)" },
                { start: 1320, end: 1350, activity: "Sleep time 😴" }
            ];

            let currentActivity = "Free time";
            for (const slot of timeSlots) {
                if (currentTime >= slot.start && currentTime < slot.end) {
                    currentActivity = slot.activity;
                    break;
                }
            }

            document.getElementById('currentActivity').textContent = currentActivity;
        }

        // Course dashboard
        function showCourseDashboard(courseName) {
            currentCourse = courseName;
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('courseDashboard').style.display = 'block';
            document.getElementById('unitView').style.display = 'none';
            document.getElementById('courseName').textContent = courseName;
            
            updateUnitsDisplay();
            
            // Load notepad content
            const notepad = document.getElementById('courseNotepad');
            notepad.value = appData.courses[courseName].notepad || '';
            notepad.addEventListener('input', () => {
                appData.courses[courseName].notepad = notepad.value;
                saveData();
            });
        }

        function showMainContent() {
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('courseDashboard').style.display = 'none';
            document.getElementById('unitView').style.display = 'none';
            currentCourse = null;
            currentUnit = null;
        }

        // Timer functions
        function startTimer() {
            const minutes = parseInt(document.getElementById('timerMinutes').value) || 25;
            if (!courseTimer) {
                courseTimer = { minutes: minutes, seconds: 0, isRunning: false };
            }
            
            if (!courseTimer.isRunning) {
                courseTimer.isRunning = true;
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function pauseTimer() {
            if (courseTimer && courseTimer.isRunning) {
                courseTimer.isRunning = false;
                clearInterval(timerInterval);
            }
        }

        function resetTimer() {
            const minutes = parseInt(document.getElementById('timerMinutes').value) || 25;
            courseTimer = { minutes: minutes, seconds: 0, isRunning: false };
            clearInterval(timerInterval);
            updateTimerDisplay();
        }

        function updateTimer() {
            if (!courseTimer || !courseTimer.isRunning) return;
            
            if (courseTimer.seconds > 0) {
                courseTimer.seconds--;
            } else if (courseTimer.minutes > 0) {
                courseTimer.minutes--;
                courseTimer.seconds = 59;
            } else {
                // Timer finished
                clearInterval(timerInterval);
                courseTimer.isRunning = false;
                alert('Timer finished!');
            }
            
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            if (!courseTimer) {
                document.getElementById('timerDisplay').textContent = '00:00:00';
                return;
            }
            
            const hours = Math.floor(courseTimer.minutes / 60);
            const mins = courseTimer.minutes % 60;
            const secs = courseTimer.seconds;
            
            document.getElementById('timerDisplay').textContent = 
                `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Unit management
        function updateUnitsDisplay() {
            const unitsGrid = document.getElementById('unitsGrid');
            unitsGrid.innerHTML = '';
            
            const units = appData.courses[currentCourse].units;
            Object.keys(units).forEach(unitName => {
                const unitCard = document.createElement('div');
                unitCard.className = 'unit-card';
                unitCard.textContent = unitName;
                unitCard.onclick = () => showUnitView(unitName);
                unitsGrid.appendChild(unitCard);
            });
        }

        function addNewUnit() {
            document.getElementById('unitModal').style.display = 'block';
        }

        function createUnit() {
            const unitName = document.getElementById('unitNameInput').value.trim();
            if (unitName && currentCourse && !appData.courses[currentCourse].units[unitName]) {
                appData.courses[currentCourse].units[unitName] = { notes: {} };
                updateUnitsDisplay();
                closeModal('unitModal');
                document.getElementById('unitNameInput').value = '';
                saveData();
            }
        }

        function showUnitView(unitName) {
            currentUnit = unitName;
            document.getElementById('courseDashboard').style.display = 'none';
            document.getElementById('unitView').style.display = 'block';
            document.getElementById('unitName').textContent = unitName;
            updateNotesDisplay();
        }

        function goToDashboard() {
            document.getElementById('unitView').style.display = 'none';
            document.getElementById('courseDashboard').style.display = 'block';
            currentUnit = null;
        }

        // Notes management
        function updateNotesDisplay() {
            const notesGrid = document.getElementById('notesGrid');
            notesGrid.innerHTML = '';
            
            const notes = appData.courses[currentCourse].units[currentUnit].notes;
            Object.keys(notes).forEach(noteTitle => {
                const noteSection = document.createElement('div');
                noteSection.className = 'note-section';
                
                const title = document.createElement('div');
                title.className = 'note-title';
                title.textContent = noteTitle;
                noteSection.appendChild(title);
                
                const subsections = notes[noteTitle];
                Object.keys(subsections).forEach(subsectionTitle => {
                    const subsection = document.createElement('div');
                    subsection.className = 'subsection';
                    subsection.textContent = subsectionTitle;
                    subsection.onclick = () => viewSubsection(noteTitle, subsectionTitle);
                    noteSection.appendChild(subsection);
                });
                
                // Add subsection button
                const addBtn = document.createElement('button');
                addBtn.textContent = '+ Add Subsection';
                addBtn.style.marginTop = '10px';
                addBtn.style.padding = '5px 10px';
                addBtn.style.border = '1px solid #ccc';
                addBtn.style.borderRadius = '4px';
                addBtn.style.cursor = 'pointer';
                addBtn.onclick = () => addSubsection(noteTitle);
                noteSection.appendChild(addBtn);
                
                notesGrid.appendChild(noteSection);
            });
        }

        function addNoteSection() {
            document.getElementById('noteModal').style.display = 'block';
        }

        function createNoteSection() {
            const noteTitle = document.getElementById('noteTitleInput').value.trim();
            if (noteTitle && currentCourse && currentUnit) {
                if (!appData.courses[currentCourse].units[currentUnit].notes[noteTitle]) {
                    appData.courses[currentCourse].units[currentUnit].notes[noteTitle] = {};
                    updateNotesDisplay();
                    closeModal('noteModal');
                    document.getElementById('noteTitleInput').value = '';
                    saveData();
                }
            }
        }

        function addSubsection(noteTitle) {
            currentNoteSection = noteTitle;
            currentSubsection = null;
            document.getElementById('subsectionTitle').textContent = 'Add Subsection';
            document.getElementById('subsectionTitleInput').value = '';
            document.getElementById('subsectionContent').value = '';
            document.getElementById('subsectionModal').style.display = 'block';
        }

        function viewSubsection(noteTitle, subsectionTitle) {
            const content = appData.courses[currentCourse].units[currentUnit].notes[noteTitle][subsectionTitle];
            document.getElementById('viewTitle').textContent = subsectionTitle;
            document.getElementById('viewContent').innerHTML = formatContent(content);
            document.getElementById('viewModal').style.display = 'block';
            
            currentNoteSection = noteTitle;
            currentSubsection = subsectionTitle;
        }

        function editCurrentSubsection() {
            if (currentNoteSection && currentSubsection) {
                const content = appData.courses[currentCourse].units[currentUnit].notes[currentNoteSection][currentSubsection];
                document.getElementById('subsectionTitle').textContent = 'Edit Subsection';
                document.getElementById('subsectionTitleInput').value = currentSubsection;
                document.getElementById('subsectionContent').value = content;
                closeModal('viewModal');
                document.getElementById('subsectionModal').style.display = 'block';
            }
        }

        function saveSubsection() {
            const title = document.getElementById('subsectionTitleInput').value.trim();
            const content = document.getElementById('subsectionContent').value.trim();
            
            if (title && content && currentCourse && currentUnit && currentNoteSection) {
                // If editing existing subsection with different title, remove old one
                if (currentSubsection && currentSubsection !== title) {
                    delete appData.courses[currentCourse].units[currentUnit].notes[currentNoteSection][currentSubsection];
                }
                
                appData.courses[currentCourse].units[currentUnit].notes[currentNoteSection][title] = content;
                updateNotesDisplay();
                closeModal('subsectionModal');
                saveData();
            }
        }

        function formatContent(content) {
            return content
                .replace(/\n/g, '<br>')
                .replace(/^\s*[•-]\s+(.+)$/gm, '<li>$1</li>')
                .replace(/^\s*(\d+)\.\s+(.+)$/gm, '<li>$2</li>')
                .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
// --- Undo Support ---
let lastDeleted = null;

function showUndoButton(type, restoreFn) {
    const undoContainer = document.getElementById('undoContainer') || document.createElement('div');
    undoContainer.id = 'undoContainer';
    undoContainer.style.position = 'fixed';
    undoContainer.style.bottom = '20px';
    undoContainer.style.right = '20px';
    undoContainer.style.background = '#333';
    undoContainer.style.color = 'white';
    undoContainer.style.padding = '10px 15px';
    undoContainer.style.borderRadius = '6px';
    undoContainer.style.zIndex = '9999';
    undoContainer.style.boxShadow = '0 2px 10px rgba(0,0,0,0.3)';
    undoContainer.style.fontSize = '14px';

    undoContainer.innerHTML = `${type} deleted. <button id="undoBtn" style="background:#4facfe;color:white;border:none;padding:4px 8px;margin-left:10px;border-radius:4px;cursor:pointer">Undo</button>`;

    document.body.appendChild(undoContainer);

    document.getElementById('undoBtn').onclick = () => {
        restoreFn();
        document.body.removeChild(undoContainer);
    };

    setTimeout(() => {
        if (document.body.contains(undoContainer)) {
            document.body.removeChild(undoContainer);
            lastDeleted = null;
        }
    }, 8000); // auto-remove after 8 sec
}

// --- Deletion Features ---
function deleteCourse(courseName) {
    if (confirm(`Delete course "${courseName}"?`)) {
        lastDeleted = {
            type: 'course',
            name: courseName,
            data: appData.courses[courseName]
        };
        delete appData.courses[courseName];
        saveData();
        updateCourseButtons();
        showMainContent();
        showUndoButton('Course', () => {
            appData.courses[lastDeleted.name] = lastDeleted.data;
            updateCourseButtons();
            saveData();
        });
    }
}

function deleteUnit(unitName) {
    if (currentCourse && confirm(`Delete unit "${unitName}" from ${currentCourse}?`)) {
        lastDeleted = {
            type: 'unit',
            name: unitName,
            course: currentCourse,
            data: appData.courses[currentCourse].units[unitName]
        };
        delete appData.courses[currentCourse].units[unitName];
        saveData();
        updateUnitsDisplay();
        showUndoButton('Unit', () => {
            appData.courses[lastDeleted.course].units[lastDeleted.name] = lastDeleted.data;
            updateUnitsDisplay();
            saveData();
        });
    }
}

function deleteScheduleRow(periodName) {
    const weekKey = getWeekKey();
    if (confirm(`Delete schedule row "${periodName}"?`)) {
        lastDeleted = {
            type: 'row',
            name: periodName,
            weekKey: weekKey,
            data: appData.schedule[weekKey][periodName]
        };
        delete appData.schedule[weekKey][periodName];
        updateScheduleDisplay();
        saveData();
        showUndoButton('Schedule row', () => {
            appData.schedule[lastDeleted.weekKey][lastDeleted.name] = lastDeleted.data;
            updateScheduleDisplay();
            saveData();
        });
    }
}

// --- Update UI to Add Delete Buttons ---
function updateCourseButtons() {
  const buttonsContainer = document.getElementById('courseButtons');
  const addButton = buttonsContainer.querySelector('.add-course-btn');

  // Remove previous course rows
  buttonsContainer.querySelectorAll('.course-wrapper').forEach(el => el.remove());

  Object.keys(appData.courses).forEach(courseName => {
    const wrapper = document.createElement('div');
    wrapper.className = 'course-wrapper';
    wrapper.draggable = true;
    wrapper.dataset.course = courseName;
    wrapper.style.display = 'flex';
    wrapper.style.alignItems = 'center';
    wrapper.style.gap = '5px';

    // Drag handlers
    wrapper.addEventListener('dragstart', (e) => {
      console.log("Start dragging", courseName);
      e.dataTransfer.setData('text/plain', courseName);
    });

    wrapper.addEventListener('dragover', (e) => {
      e.preventDefault();
    });

    wrapper.addEventListener('drop', (e) => {
      e.preventDefault();
      const dragged = e.dataTransfer.getData('text/plain');
      const target = wrapper.dataset.course;
      reorderCourses(dragged, target);
      saveData();
      updateCourseButtons();
    });

    // Course button
    const courseBtn = document.createElement('button');
    courseBtn.className = 'course-btn';
    courseBtn.textContent = courseName;
    courseBtn.onclick = () => showCourseDashboard(courseName);

    // Delete button
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = '×';
    deleteBtn.style.background = '#dc3545';
    deleteBtn.style.color = 'white';
    deleteBtn.style.border = 'none';
    deleteBtn.style.borderRadius = '4px';
    deleteBtn.style.cursor = 'pointer';
    deleteBtn.onclick = () => deleteCourse(courseName);

    wrapper.appendChild(courseBtn);
    wrapper.appendChild(deleteBtn);
    buttonsContainer.insertBefore(wrapper, addButton);
  });
}


function updateUnitsDisplay() {
    const unitsGrid = document.getElementById('unitsGrid');
    unitsGrid.innerHTML = '';
    const units = appData.courses[currentCourse].units;
    Object.keys(units).forEach(unitName => {
        const unitCard = document.createElement('div');
        unitCard.className = 'unit-card';

        const label = document.createElement('div');
        label.textContent = unitName;
        label.style.marginBottom = '10px';
        label.style.cursor = 'pointer';
        label.onclick = () => showUnitView(unitName);

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.style.padding = '4px 10px';
        deleteBtn.style.fontSize = '12px';
        deleteBtn.style.background = '#dc3545';
        deleteBtn.style.color = 'white';
        deleteBtn.style.border = 'none';
        deleteBtn.style.borderRadius = '4px';
        deleteBtn.style.cursor = 'pointer';
        deleteBtn.onclick = (e) => {
            e.stopPropagation();
            deleteUnit(unitName);
        };

        unitCard.appendChild(label);
        unitCard.appendChild(deleteBtn);
        unitsGrid.appendChild(unitCard);
    });
}

function updateScheduleDisplay() {
    const weekKey = getWeekKey();
    const scheduleData = appData.schedule[weekKey] || {};
    const tbody = document.getElementById('scheduleBody');
    tbody.innerHTML = '';

    Object.keys(scheduleData).forEach(period => {
        const row = document.createElement('tr');

        const periodCell = document.createElement('td');
        periodCell.contentEditable = true;
        periodCell.textContent = period;
        periodCell.style.fontWeight = 'bold';
        periodCell.style.background = '#f8f9ff';
        periodCell.addEventListener('blur', () => {
            const newPeriod = periodCell.textContent.trim();
            if (newPeriod !== period && newPeriod) {
                scheduleData[newPeriod] = scheduleData[period];
                delete scheduleData[period];
                saveData();
            }
        });
        row.appendChild(periodCell);

        for (let i = 0; i < 7; i++) {
            const cell = document.createElement('td');
            cell.contentEditable = true;
            cell.textContent = scheduleData[period][i] || '';
            cell.addEventListener('blur', () => {
                scheduleData[period][i] = cell.textContent;
                saveData();
            });
            row.appendChild(cell);
        }

        const deleteCell = document.createElement('td');
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '×';
        deleteBtn.style.color = 'white';
        deleteBtn.style.background = '#dc3545';
        deleteBtn.style.border = 'none';
        deleteBtn.style.borderRadius = '4px';
        deleteBtn.style.cursor = 'pointer';
        deleteBtn.onclick = () => deleteScheduleRow(period);
        deleteCell.appendChild(deleteBtn);
        row.appendChild(deleteCell);

        tbody.appendChild(row);
    });
}



  let appData = {
    courses: {},
    schedule: {},
    weekOffset: 0
  };

  function saveData() {
    localStorage.setItem('appData', JSON.stringify(appData));
  }

 function loadData() {
  const stored = localStorage.getItem('appData');
  if (stored) {
    appData = JSON.parse(stored);
  } else {
    appData = {
      courses: {
        'Example Course': {
          units: {
            'Unit 1': [],
            'Unit 2': []
          },
          notepad: ''
        }
      },
      schedule: {},
      weekOffset: 0
    };
  }

  // Ensure current week has a default schedule
  const currentWeekKey = getWeekKey();
  if (!appData.schedule[currentWeekKey]) {
    appData.schedule[currentWeekKey] = {
      "Period 1": ["", "", "", "", "", "", ""],
      "Period 2": ["", "", "", "", "", "", ""],
      "Period 3": ["", "", "", "", "", "", ""]
    };
  }

  updateCourseButtons();
  updateScheduleDisplay?.();
}


   // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
        document.addEventListener('DOMContentLoaded', () => {
  loadData();

  // Also set up autosave every 10 seconds
  setInterval(() => {
    saveData();
  }, 10000);
});

</script>

</body>
</html>
